# 9장. 일반적인 프로그램 원칙

# 아이템57. 지역변수의 범위를 최소화하라.

지역변수의 유호 범위를 최소로 줄이면 코드 가독성과 유지보수성이 높아지고 오류 가능성은 낮아진다.

1. 가장 처음 쓰일 때 선언 하기 

     : 지역 변수를 생각 없이 선언하다 보면 변수가 쓰이는 범위보다 너무 앞서 선언하거나, 다 쓴 뒤에도 여전히 살아 있게 되기 쉽다. 지역변수의 범위는 선언된 지점부터 그 지점을 포함한 블록이 끝날 때 까지이므로, 실제 사용하는 블록 바깥에 선언된 변수는 그 블록이 끝난 뒤까지 살아 있게 된다.

2. 거의 모든 지역 변수는 선언과 동시에 초기화해야 한다.

  : 초기화에 필요한 정보가 충분하지 않다면 충분해질 때까지 선언을 미뤄야 한다. 

3. 메서드를 작게 유지하고 한 가지 기능에 집중하는 것이다. 

  :  단순히 메서드를 기능별로 쪼개면 된다.

# 아이템 58. 전통적인 for문보다는 for-each문을 사용하라

반복 대상이 컬렉션이든 배열이든, for-each문을 사용해도 속도는 그대로다.

for-each문이 만들어내는 코드는 사람이 손으로 최적화 한 것과 사실상 같기때문이다.

for-each문을 사용할 수 없는 세가지 상황

- 파괴적인 필터링 : 컬렉션을 순회하면서 선택된 원소를 제거해야 한다면 반복자 remove 메서드를 호출해야 한다. 자바8부터는 Collection의 removeIf 메서드를 사용해 컬렉션을 명시적으로 순회하는 일을 피할 수 있다.
- 변형 - 리스트나 배열을 순회하면서 그 원소의 값 일부 혹은 전체를 교체해야 한다면 리스트의 반복자나 배열의 인덱스를 사용해야 한다.
- 병력 반복 - 여러 컬렉션을 병렬로 순회해야 한다면 각각의 반복자와 인덱스 변수를 사용해 엄격하고 명시적으로 제어해야 한다.

위의 세가지 경우가 아니라면, for-each문을 사용해야 하고, 위의 경우엔 for문을 사용하되 주의해야 한다.

# 아이템 59. 라이브러리를 익히고 사용하라.

1. 표준 라이브러리를 사용하면 그 코드를 작성한 전문가의 지식과 여러분보다 앞서 사용한 다른 프로그래머들의 경험을 활용할 수 있다.

자바 7부터는 randaom을 더 이상 사용하지 않는 게 좋다.

ThreadLocalRandom으로 대체하면 대부분 잘 작동한다. Random보다 더 고품질의 무작위 수를 생성할 뿐 아니라 속도도 더 빠르다.

한편, 포크조인 풀이나 병렬 스트림에서는 SplittableRandom을 사용하라.

2. 표준 라이브러리를 쓰는 두 번째 이점은 핵심적인 일과 크게 관련 없는 문제를 해결하느라 시간을 허비하지 않아도 된다는 것이다.

3. 따로 노력하지 않아도 성능이 지속해서 개선된다는 점이다.

4. 기능이 점점 많아 진다.

5. 작성한 코드가 많은 사람에게 낯익은 코드가 된다는 것

*자바프로그래머라면 적어도 java.lang, java.util,java.io와 그 하위 패키지들에는 익숙해져야 한다.

자바 10, 자바11에 새로운 기능들도 확인해보아라.

# 아이템 60. 정확한 답이 필요하다면 float과 double은 피하라

float과 double 타입은 과학과 공학 계산용으로 설계된 것.

금융 계산에는 BigDecimal, int 혹은 long을 사용해야 한다.

코딩 시 불편함이나 성능 저하를 신경 쓰지 않겠다면 BigDecimal을 사용하라.

BigDecimal이 제공하는 여덟 가지 반올림 모드를 이용하여 반올림을 완벽히 제어할 수 있다.

법으로 정해진 반올림을 수행해야 하는 비즈니스 계산에서 아주 편리한 기능이다.

반면, 성능이 중요하고 소수점을 직접 추적할 수 있고 숫자가 너무 크지 않다면 int 나 long을 사용하라. 숫자를 아홉 자리 십진수로 표현할 수 있다면 Int를 사용하고, 열여덟 자리 십진수로 표현할 수 있다면 long을 사용하라.

열여덟 자리를 넘어가면 BigDecimal을 사용해야 한다.

# 아이템 61. 박싱된 기본 타입 보다는 기본 타입을 사용하라.

기본타입 - int, double, boolean

참조타입 - String, List

박싱된 기본타입(기본타입에 대응하는 참조타입) - Integer, Double,Boolean

기본타입과 박싱의 차이점.

1. 기본 타입은 값만 가지고 있으나, 박싱된 기본 타입은 값에 더해 식별성이란 속성을 갖는다. 달리 말하면 박싱된 기본타입의 두 인스턴스는 값이 같아도 서로 다르다고 식별될 수 있다. *박싱된 기본 타입에 == 연산자를 사용하면 오류가 일어난다. 
2. 기본 타입의 값은 언제나 유효하나, 박싱된 기본 타입은 유효하지 않은 값, 즉 null을 가질 수 있다.
3. 기본 타입이 박싱된 기본 타입보다 시간과 메모리 사용면에서 더 효율적이다.

기본타입과 박싱된 기본 타입을 혼용한 연산에서는 박싱된 기본 타입의 박싱이 자동으로 풀리기 때문에, 혼용해서 쓰면 박싱과 언박싱이 반복해서 일어나 체감될 정도로 성능이 느려진다.

그렇다면 박싱된 기본 타입을 언제 써야 하는가?

1. 컬렉션의 원소, 키, 값으로 쓴다. 컬렉션은 기본 타입을 담을 수 없으므로 어쩔 수 없이 박싱된 기본 타입을 써야만 한다. 더 일반화해 말하면, 매개변수화 메서드의 타입 매개변수로는 박싱된 기본타입을 써야 한다. 자바 언어가 타입 매개변수로 기본 타입을 지원하지 않기 때문이다.
2. 리플렉션을 통해 메서드를 호출할 때도 박싱된 기본타입을 사용해야 한다. 

# 아이템 62. 다른 타입이 적절하다면 문자열 사용을 피하라.

문자열은 다른 값 타입을 대신하기에 적합하지 않다.

문자열을 잘못 사용하는 흔한 예로는 기본타입, 열거타입,혼합타입이 있다.

# 아이템 63. 문자열 연결은 느리니 주의하라.

문자열 연결 연산자로 문자열 n개를 잇는 시간은 n제곱에 비례한다.

성능을 포기하고 싶지 않다면 String 대신 StringBuilder를 사용하자.

성능에 신경써야 한다면 많은 문자열을 연겨할 때는 문자열 연결 연산자(+)를 피하자. 대신 StringBuilder의 append 메서드를 사용하라. 문자 배열을 사용하거나, 문자열 (연결하지 않고) 하나씩 처리하는 방법도 있다.

# 아이템 64. 객체는 인터페이스를 사용해 참조하라.

매개변수 타입으로 클래스가 아니라 인터페이스를 사용하라 → "객체는 클래스가 아닌 인터페이스로 참조하라"

적합한 인터페이스만 있다면 매개변수 뿐 아니라 반환값, 변수, 필드를 전부 인터페이스 타입으로 선언하라.

Set 인터페이스를 구현한 LinkedHashSet변수를 선언하는 예

```java
Set<Son> sonSet = new LinkedHashSet<>();
```

클래스 타입으로 사용하는 예

```java
LinkedHashSet<Son> sonSet = new LinkedHashSet<>();
```

인터페이스를 타입으로 사용하는 습관을 길러두면 프로그램이 훨씬 유연해질 것.

*주의할점

원래의 클래스가 인터페이스의 일반 규약 이외의 특별한 기능을 제공하며, 주변 코드가 이 기능에 기대어 동작한다면 새로운 클래스도 반드시 같은 기능을 제공해야 한다. 예컨대 첫 번째 선언의 주변 코드가 LinkedHashSet이 따르는 순서 정책을 가정하고 동작하는 상황에서 이를 HashSet으로 바꾸면 문제가 될 수 있다.

HashSet은 반복자의 순회 순서를 보장하지 않기 때문이다.

적합한 인터페이스가 없다면 클래스의 게층구조 중 필요한 기능을 만족하는 가장 덜 구체적인(상위의)클래스 타입으로 사용하자.

# 아이템 65. 리플렉션보다는 인터페이스를 사용하라.

리플렉션 기능(java.lang.reflect)를 이용하면 프로그램에서의 임의의 클래스에 접근할 수 있다.

:class 객체가 주어지면 그 클래스의 생성자, 메서드, 필드에 해당하는 Constructor,Method,Field 인스턴스를 가져올 수 있고, 이어서 이 인스턴스들로는 그 클래스의 멤버 이름, 필드 타입, 메서드 시그닟터 등을 가져올 수 있다.

리플렉션은 아주 제한된 형태로만 사용해야 그 단점을 피하고 이점을 취할 수 있다.

리플렉션은 인스턴스 생성에만 쓰고, 이렇게 만든 인스턴스는 인터페이스나 상위 클래스로 참조해 사용하자.

아이템 66. 네이티브 메서드는 신중히 사용하라

자바 네이티브 인터페이스 : 자바 프로그램이 네이티브 메서드를 호출하는 기술

네이티브 메서드 : c나 c++같은 네이티브 프로그래밍 언어로 작성한 메서드.

네이티브 메서드의 기능

1. 레지스트리 같은 플랫폼 특화기능을 사용한다.
2. 네이티브 코드로 작성된 기존 라이브러리를 사용한다. 레거시 데이터를 사용하는 레거시 라이브러리가 그 예다.
3. 성능 개선을 목적으로 성능에 결정적인 영향을 주는 영역만 따로 네이티브언어로 작성한다.

# 아이템 67. 최적화는 신중히 하라.

빠른 프로그램보다는 좋은 프로그램을 작성하라.

# 아이템 68. 일반적으로 통용되는 명명 규칙을 따르라.

통용되는 명명 규칙을 따라라..